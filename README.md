# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Vite

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run dev
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
# Интернет-магазин «Web-Larёk»
«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.  
View - слой представления, отвечает за отображение данных на странице.  
Presenter - презентер содержит основную логику приложения и  отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component
Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`


#### Класс Api
Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter
Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` -  хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.


### Данные

#### Интерфейсы данных

Для описания структуры данных в приложении используются следующие интерфейсы:

##### Товар (IProduct)

```
interface IProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
}
```
Назначение: 
Описывает структуру товара в каталоге магазина. Содержит всю необходимую информацию для отображения товара пользователю.

##### Покупатель (IBuyer)

```
interface IBuyer {
  payment: TPayment;
  email: string;
  phone: string;
  address: string;
}
```
Назначение: 
Описывает структуру данных покупателя, необходимых для оформления заказа. Включает контактную информацию и способ оплаты.

### Модели данных

#### Класс ProductList

Назначение и зона ответственности: Отвечает за хранение и управление каталогом товаров магазина. Содержит методы для получения информации о товарах и управления выбранным товаром для детального просмотра.


Конструктор:

`constructor()` - Не принимает параметров, инициализирует пустые массивы товаров.


Поля класса:

`products: IProduct[]` - массив всех товаров каталога

`selectedProduct: IProduct | null` - товар, выбранный для подробного отображения


Методы класса:

`setProducts(products: IProduct[]): void` - сохраняет массив товаров, полученный в параметрах метода

`getProducts(): IProduct[]` - возвращает массив всех товаров из модели

`getProductById(id: string): IProduct | undefined` - возвращает товар по его id

`setSelectedProduct(product: IProduct): void` - сохраняет товар для подробного отображения

`getSelectedProduct(): IProduct | null` - возвращает товар для подробного отображения

#### Класс Cart
Назначение и зона ответственности: Управляет корзиной покупок. Отвечает за добавление, удаление товаров, подсчет общей стоимости и количества товаров в корзине.

Конструктор:
`constructor()` - Не принимает параметров, инициализирует пустой массив товаров в корзине.

Поля класса:
`items: IProduct[]` - массив товаров, выбранных покупателем для покупки

Методы класса:
`getItems(): IProduct[]` - возвращает массив товаров, которые находятся в корзине

`addItem(item: IProduct): void` - добавляет товар, полученный в параметре, в массив корзины

`removeItem(item: IProduct): void` - удаляет товар, полученный в параметре, из массива корзины

`clearCart(): void` - полностью очищает корзину

`getTotalPrice(): number` - возвращает общую стоимость всех товаров в корзине

`getItemsCount(): number` - возвращает общее количество товаров в корзине

`containsItem(id: string): boolean` - проверяет наличие товара в корзине по его id

#### Класс Buyer
Назначение и зона ответственности: Управляет данными покупателя. Отвечает за хранение, валидацию и управление информацией о покупателе, необходимой для оформления заказа.

`constructor()` - Не принимает параметров, инициализирует пустые поля данных покупателя.

Поля класса:
`payment: TPayment` - способ оплаты

`email: string` - электронная почта

`phone: string` - телефон

`address: string` - адрес доставки

Методы класса:

`setData(data: Partial<IBuyer>): void` - сохраняет данные покупателя. Принимает объект с частичными данными, позволяя обновлять отдельные поля без удаления остальных

`getData(): IBuyer` - возвращает все данные покупателя

`clearData(): void` - очищает все данные покупателя

`validate(): ValidationResult` - выполняет валидацию всех полей. Возвращает объект с информацией об ошибках валидации

Тип ValidationResult:
```
type ValidationResult = {
  payment?: string;
  email?: string;
  phone?: string;
  address?: string;
}
```

Пример использования валидации:
```
// Если есть ошибки в полях payment и email
{
  payment: 'Не выбран вид оплаты',
  email: 'Укажите емэйл'
}
// Если все поля валидны - возвращается пустой объект
{}
```

### Слой коммуникации

#### Класс ShopApi
Назначение и зона ответственности: Отвечает за взаимодействие с сервером API магазина. Обеспечивает получение каталога товаров и отправку данных заказа на сервер.

Конструктор:
`constructor(api: IApi)` - Принимает объект, соответствующий интерфейсу IApi, для выполнения HTTP-запросов.

Поля класса:
`api: IApi` - объект для выполнения HTTP-запросов

Методы класса:
`getProductList(): Promise<IProduct[]>` - выполняет GET запрос на эндпоинт /product/ и возвращает промис с массивом товаров

`submitOrder(orderData: IOrder): Promise<IOrderResult>` - выполняет POST запрос на эндпоинт /order/ и передает данные заказа, возвращает промис с результатом оформления заказа


### Слой представления

#### Класс Header
Назначение и зона ответственности: Наследуется от Component<HeaderData>. Отвечает за отображение шапки приложения, включая счетчик товаров в корзине и кнопку для взаимодействия с корзиной.

Конструктор:
`constructor(container: HTMLElement)` - принимает DOM-элемент, который будет контейнером шапки.

Поля класса:
`basketButton: HTMLButtonElement` - кнопка для открытия корзины
`counterElement: HTMLElement` - элемент для отображения количества товаров в корзине

События:
`header:open-cart` - генерируется при клике на кнопку корзины

Методы класса:
`render(data: HeaderData): HTMLElement` - отображает шапку с переданными данными
`setCounter(value: number): void` - обновляет значение счетчика товаров в корзине

Данные:
```
interface HeaderData {
  counter: number;
}
```


#### Класс Gallery
Назначение и зона ответственности: Наследуется от Component<GalleryData>. Отвечает за отображение галереи товаров - контейнера для карточек товаров в каталоге.

Конструктор:
`constructor(container: HTMLElement)` - принимает DOM-элемент, который будет контейнером галереи.

Поля класса:

`galleryElement: HTMLElement` - основной элемент галереи, содержащий карточки товаров

Методы класса:
`render(data: GalleryData): HTMLElement` - отображает галерею с переданными данными
`setCatalog(items: HTMLElement[]): void` - обновляет содержимое галереи, отображая переданный массив карточек товаров

Данные:
```
interface GalleryData {
  catalog: HTMLElement[];
}
```


#### Класс Modal
Назначение и зона ответственности: Наследуется от Component<ModalData>. Является универсальным контейнером для отображения различного контента в модальном окне. Может использоваться для показа деталей товара, корзины, формы оформления заказа и других вспомогательных окон. От этого класса НЕ наследуются другие модальные окна. Все специализированные окна (подтверждение, формы и т.д.) - независимые компоненты,которые могут отображаться внутри этого универсального модального контейнера.

Конструктор:
`constructor(container: HTMLElement)` - принимает DOM-элемент, который будет контейнером модального окна.

Поля класса:
`modalElement: HTMLElement` - основной элемент модального окна, содержащий переданный контент
`modalClose: HTMLButtonElement` - кнопка закрытия модального окна
`overlay: HTMLElement` - затемненный фон модального окна

События:
`modal:open` - генерируется при открытии модального окна
`modal:close` - генерируется при закрытии модального окна

Методы класса:
`render(data: ModalData): HTMLElement` - инициализирует модальное окно с базовой разметкой
`setContent(content: HTMLElement): void` - устанавливает переданный контент в модальное окно
`open(): void` - открывает модальное окно
`close(): void` - закрывает модальное окно
`handleClose(): void` - обработчик закрытия модального окна (по кнопке или клику на оверлей)

Данные:
```
interface ModalData {
  content: HTMLElement;
}
```


##### Класс ModalSuccess
Назначение и зона ответственности: Наследуется от Component<ModalSuccessData>. Отображает содержимое для окна подтверждения заказа. Может быть встроен в универсальное модальное окно Modal.

Конструктор:
`constructor(container: HTMLElement)` - принимает DOM-элемент контейнера

Поля класса:
`successElement: HTMLElement` - элемент с контентом подтверждения
`closeButton: HTMLButtonElement` - кнопка закрытия
`descriptionElement: HTMLElement` - элемент для отображения суммы

События:
`success:close` - генерируется при закрытии

Методы класса:
`render(data: ModalSuccessData): HTMLElement` - отображает контент подтверждения
`setTotalAmount(amount: number): void` - обновляет сумму

Данные:
```
interface ModalSuccessData {
  totalAmount: number;
}
```


#### Класс Product
Назначение и зона ответственности: Абстрактный класс, наследуется от Component<IProduct>. 
Содержит общую логику для всех представлений товаров

Конструктор:
`constructor(container: HTMLElement, templateId: string)` - принимает контейнер и ID шаблона

Поля класса:
`productElement: HTMLElement` - основной элемент товара

Методы класса:
`setTitle(title: string): void` - устанавливает название
`setPrice(price: number): void` - устанавливает цену  
`setImage(src: string, alt?: string): void` - устанавливает изображение



##### Класс ProductCard (карточка в каталоге)
Назначение и зона ответственности: Наследуется от Product. Отображает товар в виде карточки в галерее каталога.

Конструктор:
`constructor(container: HTMLElement)` - использует шаблон card-catalog

События:
`card:select` - генерируется при клике на карточку товара

Методы класса:
`render(data: IProduct): HTMLElement` - рендерит карточку товара для каталога


##### Класс ProductPreview (детальный просмотр)
Назначение и зона ответственности: Наследуется от Product. Отображает детальную информацию о товаре в модальном окне.

Конструктор:
`constructor(container: HTMLElement)` - использует шаблон card-preview

События:
`preview:add-to-cart` - генерируется при клике на кнопку "В корзину"

Методы класса:
`render(data: IProduct): HTMLElement` - рендерит детальное представление товара
`setDescription(description: string): void` - устанавливает описание товара


##### Класс BasketItem (товар в корзине)
Назначение и зона ответственности: Наследуется от Product. Отображает товар в списке корзины покупок.

Конструктор:
`constructor(container: HTMLElement)` - использует шаблон card-basket

События:
`basket:remove` - генерируется при клике на кнопку удаления товара

Методы класса:
`render(data: IProduct): HTMLElement` - рендерит товар для корзины с порядковым номером
`setIndex(index: number): void`- устанавливает порядковый номер товара в корзине


#### Класс Basket
Назначение и зона ответственности: Наследуется от Component<BasketData>. Отображает содержимое корзины покупок.

Конструктор:
`constructor(container: HTMLElement)` - использует шаблон basket

Поля класса:
`basketElement: HTMLElement` - основной элемент корзины
`itemsList: HTMLElement` - список товаров в корзине
`totalPriceElement: HTMLElement` - элемент для отображения общей стоимости
`checkoutButton: HTMLButtonElement` - кнопка оформления заказа

События:
`basket:checkout` - генерируется при клике на кнопку оформления заказа

Методы класса:
`render(data: BasketData): HTMLElement` - отображает корзину с переданными данными
`setItems(items: HTMLElement[]): void` - устанавливает список товаров в корзине
`setTotalPrice(price: number): void` - обновляет отображение общей стоимости

Данные:
```
interface BasketData {
  items: HTMLElement[];
  totalPrice: number;
}
```

#### Абстрактный класс Form
Назначение и зона ответственности: Наследуется от Component<FormData>. Базовый класс для всех форм в приложении.

Конструктор:
`constructor(container: HTMLElement, templateId: string)` - принимает контейнер и ID шаблона формы

Поля класса:
`formElement: HTMLFormElement` - элемент формы
`submitButton: HTMLButtonElement` - кнопка отправки формы
`errorsElement: HTMLElement` - элемент для отображения ошибок

Методы класса:
`render(data: FormData): HTMLElement` - отображает форму
`validate(): ValidationResult` - выполняет валидацию формы
`getData(): object` - возвращает данные формы
`setErrors(errors: string[]): void` - отображает ошибки валидации


##### Класс OrderForm (форма заказа)
Назначение и зона ответственности: Наследуется от Form. Отображает форму выбора способа оплаты и адреса доставки.

Конструктор:
`constructor(container: HTMLElement)` - использует шаблон order

Поля класса:
`paymentButtons: NodeListOf<HTMLButtonElement>` - кнопки выбора способа оплаты
`addressInput: HTMLInputElement` - поле ввода адреса

События:
`order:submit` - генерируется при отправке формы заказа
`payment:change` - генерируется при изменении способа оплаты

Методы класса:
`render(data: FormData): HTMLElement` - отображает форму заказа
`setPaymentMethod(method: TPayment): void` - устанавливает способ оплаты
`validate(): ValidationResult` - выполняет валидацию формы заказа


##### Класс ContactsForm (форма контактов)
Назначение и зона ответственности: Наследуется от Form. Отображает форму ввода контактных данных.

Конструктор:
`constructor(container: HTMLElement)` - использует шаблон contacts

Поля класса:
`emailInput: HTMLInputElement` - поле ввода email
`phoneInput: HTMLInputElement` - поле ввода телефона

События:
`contacts:submit`- генерируется при отправке формы контактов

Методы класса:
`render(data: FormData): HTMLElement` - отображает форму контактов
`validate(): ValidationResult` - выполняет валидацию формы контактов


## События приложения

### ProductCard
`card:select` - выбор товара для просмотра (передает { id: string })
`card:add-to-cart` - добавление товара в корзину (передает { id: string })

### ProductPreview  
`preview:add-to-cart` - добавление товара в корзину из preview (передает { id: string })

### BasketItem
`basket:remove` - удаление товара из корзины (передает { id: string })

### Header
`header:open-cart` - открытие корзины

### Basket
`basket:checkout` - оформление заказа

### OrderForm
`order:submit` - отправка формы заказа
`payment:change` - изменение способа оплаты (передает { payment: TPayment })

### ContactsForm
`contacts:submit` - отправка формы контактов

### Modal
`modal:open` - открытие модального окна  
`modal:close` - закрытие модального окна

### ModalSuccess
`success:close` - закрытие окна успешного заказа



## События моделей (Model Events)

### ProductList
`productlist:changed` - изменение списка товаров. Данные: IProduct[]
`productlist:selected` - выбор товара для детального просмотра. Данные: IProduct

### Cart
`cart:changed` - изменение содержимого корзины. Данные: IProduct[]
`cart:item-added` - добавление товара в корзину. Данные: IProduct
`cart:item-removed` - удаление товара из корзины. Данные: IProduct
`cart:cleared` - очистка корзины. Данные: нет

### Buyer
`buyer:changed` - изменение данных покупателя. Данные: Partial<IBuyer>
`buyer:validated` - результат валидации данных. Данные: { isValid: boolean; errors: ValidationResult }
`buyer:cleared` - очистка данных покупателя. Данные: нет

## Презентер

### Архитектурный подход
Для проекта "Веб-Ларёк" выбран подход единого презентера в main.ts. Это решение обосновано следующими факторами:
1. Простота приложения - одностраничное приложение с четким flow
2. Низкая сложность - ограниченное количество экранов и состояний
3. Быстрая разработка - отсутствие необходимости в сложной инжекции зависимостей
4. Прозрачность потока данных - вся логика сосредоточена в одном файле

### Принципы реализации:
Презентер только обрабатывает события - не генерирует новые
Разделение ответственности - презентер координирует работу моделей и представлений
Реактивное обновление - представления обновляются только при изменении данных в моделях
Отсутствие прямой связи - модели и представления не знают о существовании друг друга

### Основные обязанности презентера:
1. Инициализация приложения
2. Обработка событий от представлений (действия пользователя)
3. Обработка событий от моделей (изменение данных)
4. Координация обновления представлений
5. Управление модальными окнами